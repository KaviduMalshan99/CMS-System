<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            border: 1px solid #000;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #000;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h2>Premium Battery Invoice</h2>
    
    <h3>Company Details</h3>
    <p><strong>Company Name:</strong> {{ $companyDetails->company_name ?? 'Premium Battery' }}</p>
    <p><strong>Address:</strong> {{ $companyDetails->address ?? 'N/A' }}</p>
    <p><strong>Email:</strong> {{ $companyDetails->email ?? 'N/A' }}</p>
    <p><strong>Contact:</strong> {{ $companyDetails->contact ?? 'N/A' }}</p>
    
    <h3>Invoice Details</h3>
    <p><strong>Date:</strong> date</p>
    <p><strong>Purchase ID:</strong> {{ $purchase->purchase_id ?? 'N/A' }}</p>
    
  
    <h3>Purchased Items</h3>
    @php
    // Convert lubricant IDs and quantities into arrays, trimming spaces
    $lubricantIds = array_map('trim', explode(',', $purchase->lubricant_ids));
    $quantities = array_map('trim', explode(',', $purchase->quantity));

    // Fetch lubricants with both 'name' and 'model_no'
    $lubricants = \App\Models\Lubricant::whereIn('id', $lubricantIds)
        ->get(['id', 'name', 'model_no'])
        ->keyBy('id'); // Index by ID for easy access
@endphp

<table>
    <tr>
        <th>Item Name</th>
        <th>Model No</th>
        <th>Quantity</th>
    </tr>

    @foreach ($lubricantIds as $index => $lubricantId)
        <tr>
            <td>{{ $lubricants[$lubricantId]->name ?? 'Unknown' }}</td> {{-- Lubricant Name --}}
            <td>{{ $lubricants[$lubricantId]->model_no ?? 'N/A' }}</td> {{-- Model No --}}
            <td>{{ $quantities[$index] ?? 0 }}</td> {{-- Corresponding Quantity --}}
        </tr>
    @endforeach
</table>

    
    
    
    
    
    <h3>Charges Summary</h3>
    <table>
        <tr>
            <th>Description</th>
            <th>Amount (LKR)</th>
        </tr>
        <tr>
            <td><strong>Sub Total</strong></td>
            <td>{{ number_format($purchase->subtotal, 2) }}</td>
        </tr>
        <tr>
            <td><strong>Total Cost</strong></td>
            <td>{{ number_format($purchase->due_amount, 2) }}</td>
        </tr>
    </table>
    
    <h3>Payment Details</h3>
    <table>
        <tr>
            <th>Payment Type</th>
            <th>Payment Status</th>
            <th>Paid Amount (LKR)</th>
            <th>Due Amount (LKR)</th>
        </tr>
        <tr>
            <td>{{ $purchase->payment_type ?? 'N/A' }}</td>
            <td>{{ $purchase->payment_status ?? 'Pending' }}</td>
            <td>{{ number_format($purchase->paid_amount ?? 0, 2) }}</td>
            <td>{{ number_format($purchase->due_amount, 2) }}</td>
        </tr>
    </table>
    
    <h3>Prepared By:</h3>
    <p><strong>{{ Auth::user()->name ?? 'N/A' }}</strong></p>
    <p><em>Authorized Representative</em></p>
    
    <p>This invoice serves as an official document for your purchase. Please retain it for future reference. Thank you for choosing <strong>Premium Battery</strong>!</p>

</body>
</html>
